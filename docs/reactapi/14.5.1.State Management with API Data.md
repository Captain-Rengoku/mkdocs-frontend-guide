---
date: 
  created: 2025-08-12
---

# State Management with API Data (**React Query**)

## 1️⃣ Without Libraries (Vanilla React)

- **Store API Response in Component State**
  - Use `useState` and `useEffect` to fetch and store data.
  - Example:

    ```javascript
    const [users, setUsers] = useState([]);
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState(null);

    useEffect(() => {
      fetch("https://api.example.com/users")
        .then(res => res.json())
        .then(data => setUsers(data))
        .catch(err => setError(err))
        .finally(() => setLoading(false));
    }, []);
    ```

- **Lift State Up to Parent**
  - If multiple child components need the same data, store it in the parent and pass as props.
  - Example:

    ```javascript
    function ParentComponent() {
      const [users, setUsers] = useState([]);
      // fetch data here and pass users to children
      return <ChildComponent users={users} />;
    }
    ```

---

## 2️⃣ With React Query

- **Automatic State Management**
  - `useQuery` handles loading, error, and data states automatically.
  - Example:

    ```javascript
    import { useQuery } from "@tanstack/react-query";

    const fetchUsers = async () => {
      const res = await fetch("https://api.example.com/users");
      if (!res.ok) throw new Error("Failed to fetch");
      return res.json();
    };

    export default function UsersList() {
      const { data, isLoading, isError, error } = useQuery({
        queryKey: ["users"],
        queryFn: fetchUsers
      });

      if (isLoading) return <p>Loading...</p>;
      if (isError) return <p>Error: {error.message}</p>;

      return (
        <ul>
          {data.map(user => (
            <li key={user.id}>{user.name}</li>
          ))}
        </ul>
      );
    }
    ```

- **Key Advantages**
  - **Caching** – Data is stored and reused automatically.
  - **Background Updates** – React Query refetches stale data in the background.
  - **Automatic Error Handling** – `isError` and `error` state provided.
  - **Optimistic UI Updates** – Can update UI immediately before server confirmation (with mutations).
  - **Dependent Queries** – Fetch one query only after another completes.

---

## 3️⃣ Comparison

| Feature | Vanilla React | React Query |
|---------|---------------|------------|
| Loading / Error State | Manual | Automatic |
| Caching | ❌ None | ✅ Built-in |
| Refetch / Polling | Manual | ✅ Configurable |
| Optimistic Updates | Manual | ✅ Built-in with mutations |
| Dependent Queries | Manual | ✅ Supported |
| Global DevTools | ❌ | ✅ React Query DevTools |
